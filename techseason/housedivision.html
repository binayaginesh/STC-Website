<!DOCTYPE html>
<html lang="en">

<head>
    <title>Tech Season</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" href="./favicon.png" type="image/png">

    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
    <link rel="stylesheet" href="fonts/icomoon/style.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="css/jquery-ui.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    <link rel="stylesheet" href="css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css">
    <link rel="stylesheet" href="css/aos.css">

    <link rel="stylesheet" href="css/style.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<body>

    <div class="site-wrap">

        <div class="site-mobile-menu">
            <div class="site-mobile-menu-header">
                <div class="site-mobile-menu-close mt-3">
                    <span class="icon-close2 js-menu-toggle"></span>
                </div>
            </div>
            <div class="site-mobile-menu-body"></div>
        </div>

        <header class="site-navbar py-3" role="banner">
            <div class="container-fluid">
                <div class="row align-items-center">
                    <div class="col-11 col-xl-2">
                        <h1 class="mb-0"><a href="./index.html" class="text-white h2 mb-0">TECH<span
                                    class="text-primary">SEASON</span></a></h1>
                    </div>
                    <div class="col-12 col-md-10 d-none d-xl-block">
                        <nav class="site-navigation position-relative text-right" role="navigation">
                            <ul class="site-menu js-clone-nav mx-auto d-none d-lg-block">
                                <li><a href="./index.html">Home</a></li>
                                <li><a href="https://docs.google.com/document/d/1K8PaABIOqdFSkbvkWgcCM-hP-LWoxV7wPsF1rK50pCY"
                                        target="_blank">Rulebook</a></li>
                                <li class="active"><a href="./housedivision.html">Houses</a></li>
                                <li><a href="./leaderboard.html">Leaderboard</a></li>
                                <li><a href="../index.html">STC</a></li>
                                <li><a href="./contact.html">Contact</a></li>
                                <li class="cta"><a href="./ictc.html">ICTC 2.0</a></li>
                            </ul>
                        </nav>
                    </div>
                    <div class="d-inline-block d-xl-none ml-md-0 mr-auto py-3" style="position: relative; top: 3px;"><a
                            href="#" class="site-menu-toggle js-menu-toggle text-white"><span class="icon-menu h3"></span></a></div>
                </div>
            </div>
        </header>


        <div class="site-section site-hero">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-10">
                        <h1 class="d-block mb-4" data-aos="fade-up" data-aos-delay="100">House Division</h1>
                        <span class="d-block mb-5 caption" data-aos="fade-up" data-aos-delay="300">Search your roll number or name</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="site-section">
            <div class="container">

                <!-- <h3 data-aos="fade-up" data-aos-delay="100">Tech Season Leaderboard</h3> -->
                <p>Enter your Roll No. or Name to search or select the group to see all its entries</p>
                <div class="d-flex">
                    <input type="text" placeholder="Type your Name or Roll number" id="searchbox" style="margin: 20px 0; width: 100%; margin-top: 0px;"/>
                    <img src="./images/SearchIcon.png" id="search_roll" class="searchicon" alt="" style="height: 50px; width: auto; margin-top: -6px"/>
                </div>
                <div class="mb-4">
                    <hr data-content="OR" class="hr-text">
                </div>
                <div id="leader-div" data-aos="fade-up" data-aos-delay="300">
                    <p>Leaderboard loading...</p>
                </div>
            </div>
        </div>

        <footer class="site-footer">
            <div class="container">
                <div class="row mb-5">
                    <div class="col-md-4">
                        <h2 class="footer-heading text-uppercase mb-4">About IIT Patna</h2>
                        <p>Indian Institute of Technology Patna is one of the new IITs established by an Act of the
                            Indian Parliament on August 06, 2008.</p>
                    </div>
                    <div class="col-md-3 ml-auto">
                        <h2 class="footer-heading text-uppercase mb-4">Quick Links</h2>
                        <ul class="list-unstyled">
                            <li><a href="https://www.iitp.ac.in/" target="_blank">IIT Patna</a></li>
                            <li><a href="https://www.iitp.ac.in/gymkhana/" target="_blank">Gymkhana IIT Patna</a></li>
                            <li><a href="https://stc.iitp.ac.in/" target="_blank">Technical Council</a></li>
                            <li><a href="https://stc.iitp.ac.in/techseason/" target="_blank">Tech Season</a></li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <div class="row-md-12">
                            <h2 class="footer-heading text-uppercase mb-4">Connect with Us</h2>
                            <p>
                                <a href="https://www.facebook.com/stc.iitp/" class="p-2 pl-0" target="_blank"><span
                                        class="icon-facebook"></span></a>
                                <a href="mailto:stc.iitp@gmail.com" class="p-2" target="_blank"><span
                                        class="icon-mail_outline"></span></a>
                                <a href="https://twitter.com/stc_iitp" class="p-2" target="_blank"><span
                                        class="icon-twitter" target="_blank"></span></a>
                                <a href="https://www.instagram.com/stc.iitp/" class="p-2" target="_blank"><span
                                        class="icon-instagram" target="_blank"></span></a>
                            </p>
                        </div>
                        <div class="row-md-12">
                            <div class="col-lg-5">
                                <img src="./images/stc_icon_tr.png" alt="Image" class="img-fluid">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">

                    <div class="col-md-12 text-center">
                        <div class="border-top pt-5">
                            <p>
                                Copyright &copy;
                                <script>
                                    document.write(new Date().getFullYear());
                                </script> All rights reserved | STC IIT Patna
                                <a href="https://colorlib.com" target="_blank"></a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </footer>

    </div>

    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/jquery-migrate-3.0.1.min.js"></script>
    <script src="js/jquery-ui.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.stellar.min.js"></script>
    <script src="js/jquery.countdown.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/bootstrap-datepicker.min.js"></script>
    <script src="js/aos.js"></script>

    <script src="js/main.js"></script>

    <script type="text/javascript">
        $.ajax({
            url: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS8dHAjWp9kvXtN564RcOvaBZQwBQ76tUaAB_HI216z-gykevMzwppC5w0DdGYZ63QHhUTl1P_ylA6-/pub?gid=0&single=true&output=csv',
            success: loadDataToState,
            error: function () {
                $('#leader-div').html('<p>Leaderboard could not be fetched.</p>');
            }
        });

        var auriga = [];
        var pegasus = [];
        var cassiopeia = [];
        var draco = [];

        var aurigaClone = [];
        var pegasusClone = [];
        var cassiopeiaClone = [];
        var dracoClone = [];

        function loadDataToState(data) {

            var rows = data.split(/\r?\n|\r/);
            if (rows.length <= 1) {
                $('#leader-div').html('<p>Data could not be parsed.</p>');
                return;
            }

            for (var i = 1; i < rows.length; i++) {
                var cells = rows[i].split(',');
                if (cells.length == 0) {
                    $('#leader-div').html('<p>Data could not be parsed.</p>');
                    return;
                }
                if (cells[0].length != 0) {
                    // console.log(cells[3])
                    if (cells[3] == 'Auriga') {
                        auriga.push({
                            roll: cells[0],
                            name: cells[1],
                            program: cells[2],
                        })
                    }
                    else if (cells[3] == 'Pegasus') {
                        pegasus.push({
                            roll: cells[0],
                            name: cells[1],
                            program: cells[2],
                        })
                    }
                    else if (cells[3] == 'Cassiopeia') {
                        cassiopeia.push({
                            roll: cells[0],
                            name: cells[1],
                            program: cells[2],
                        })
                    }
                    else if (cells[3] == 'Draco') {
                        draco.push({
                            roll: cells[0],
                            name: cells[1],
                            program: cells[2],
                        })
                    }
                }





                // pegasus.push({
                //     roll: cells[2],
                //     name: cells[3]
                // })
                // cassiopeia.push({
                //     roll: cells[4],
                //     name: cells[5]
                // })
                // draco.push({
                //     roll: cells[6],
                //     name: cells[7]
                // })
                aurigaClone = auriga;
                pegasusClone = pegasus;
                cassiopeiaClone = cassiopeia;
                dracoClone = draco;
            }

            // renderTableToDom(auriga, pegasus, cassiopeia, draco);
            renderTableToDom([], [], [], []);
        }

        function renderTableToDom(auriga, pegasus, cassiopeia, draco) {
            var table = '';
            table +=
                `<table class=\"table table-borderless table-hover table-responsive-sm table-sm\">
                    <span>Select House</span>
                    <select id="houseOptions" onchange="renderHouseChange()" style="margin: 0 0 20px 0; width: 100%;">
                        <option ${!(auriga.length != 0 && pegasus.length == 0 && cassiopeia.length == 0 && draco.length == 0) && !(auriga.length == 0 && pegasus.length != 0 && cassiopeia.length == 0 && draco.length == 0) && !(auriga.length == 0 && pegasus.length == 0 && cassiopeia.length != 0 && draco.length == 0) && !(auriga.length == 0 && pegasus.length == 0 && cassiopeia.length == 0 && draco.length != 0) ? 'selected' : ''} value="all" id="all">All</option>
                        <option ${auriga.length != 0 && pegasus.length == 0 && cassiopeia.length == 0 && draco.length == 0 ? 'selected' : ''} value="auriga" id="auriga">Auriga</option>
                        <option ${auriga.length == 0 && pegasus.length != 0 && cassiopeia.length == 0 && draco.length == 0 ? 'selected' : ''} value="pegasus" id="pegasus">Pegasus</option>
                        <option ${auriga.length == 0 && pegasus.length == 0 && cassiopeia.length != 0 && draco.length == 0 ? 'selected' : ''} value="cassiopeia" id="cassiopeia">Cassiopeia</option>
                        <option ${auriga.length == 0 && pegasus.length == 0 && cassiopeia.length == 0 && draco.length != 0 ? 'selected' : ''} value="draco" id="draco">Draco</option>
                        </select>
                        <thead><tr class="bg-primary"><th scope="col">Roll No.</th><th scope="col">Name</th><th scope="col">Program</th><th scope="col">House</th></tr></thead><tbody>`;
            for (var i = 0; i < auriga.length; i++) {
                table += '<tr>';
                table += '<td class=\"stud-details\">' + auriga[i].roll + '</td>';
                table += '<td class=\"stud-details\">' + auriga[i].name + '</td>';
                table += '<td class=\"stud-details\">' + auriga[i].program + '</td>';
                table += '<th scope="row" class=\"stud-details\">Auriga</th>';
                table += '</tr>';
            }
            // table +=
            // '</tbody></table><table class=\"table table-borderless table-hover\""><thead><tr class="bg-primary"><th scope="col">Roll No.</th><th scope="col">Name</th><th scope="col">House</th></tr></thead><tbody>';
            for (var i = 0; i < pegasus.length; i++) {
                table += '<tr>';
                table += '<td class=\"stud-details\">' + pegasus[i].roll + '</td>';
                table += '<td class=\"stud-details\">' + pegasus[i].name + '</td>';
                table += '<td class=\"stud-details\">' + pegasus[i].program + '</td>';
                table += '<th scope="row" class=\"stud-details\">Pegasus</th>';
                table += '</tr>';
            }
            // table +=
            // '</tbody></table><table class=\"table table-borderless table-hover\""><thead><tr class="bg-primary"><th scope="col">Roll No.</th><th scope="col">Name</th><th scope="col">House</th></tr></thead><tbody>';
            for (var i = 0; i < cassiopeia.length; i++) {
                table += '<tr>';
                table += '<td class=\"stud-details\">' + cassiopeia[i].roll + '</td>';
                table += '<td class=\"stud-details\">' + cassiopeia[i].name + '</td>';
                table += '<td class=\"stud-details\">' + cassiopeia[i].program + '</td>';
                table += '<th scope="row" class=\"stud-details\">Cassiopeia</th>';
                table += '</tr>';
            }
            // table +=
            // '</tbody></table><table class=\"table table-borderless table-hover\""><thead><tr class="bg-primary"><th scope="col">Roll No.</th><th scope="col">Name</th><th scope="col">House</th></tr></thead><tbody>';
            for (var i = 0; i < draco.length; i++) {
                table += '<tr>';
                table += '<td class=\"stud-details\">' + draco[i].roll + '</td>';
                table += '<td class=\"stud-details\">' + draco[i].name + '</td>';
                table += '<td class=\"stud-details\">' + draco[i].program + '</td>';
                table += '<th scope="row" class=\"stud-details\">Draco</th>';
                table += '</tr>';
            }
            table += '</tbody></table>';
            $('#leader-div').html(table);
        }

        const debounce = (func, delay) => {
            let debounceTimer
            return function () {
                const context = this
                const args = arguments
                clearTimeout(debounceTimer)
                debounceTimer
                    = setTimeout(() => func.apply(context, args), delay)
            }
        }

        var searchbox = document.querySelector('#searchbox');
        // searchbox.addEventListener('keyup', debounce(renderSearch, 200));

        var searchIcon = document.querySelector('#search_roll');
        searchIcon.addEventListener('click', debounce(renderSearch, 200));

        function renderSearch() {
            var inp = searchbox.value;
            if (!inp.trim()) {
                aurigaClone = auriga;
                pegasusClone = pegasus;
                cassiopeiaClone = cassiopeia;
                dracoClone = draco;
                renderTableToDom(auriga, pegasus, cassiopeia, draco);
                return 0;
            }
            inp = inp.toLowerCase();
            aurigaClone = [];
            auriga.forEach((obj) => {
                var {
                    roll,
                    name,
                    program
                } = obj;
                roll = roll.toLowerCase();
                name = name.toLowerCase();
                program = program.toLowerCase();
                if (roll.includes(inp) || name.includes(inp) || program.includes(inp)) {
                    aurigaClone.push(obj);
                }
            })
            pegasusClone = [];
            pegasus.forEach((obj) => {
                var {
                    roll,
                    name,
                    program
                } = obj;
                roll = roll.toLowerCase();
                name = name.toLowerCase();
                program = program.toLowerCase();
                if (roll.includes(inp) || name.includes(inp) || program.includes(inp)) {
                    pegasusClone.push(obj);
                }
            })
            cassiopeiaClone = [];
            cassiopeia.forEach((obj) => {
                var {
                    roll,
                    name,
                    program
                } = obj;
                roll = roll.toLowerCase();
                name = name.toLowerCase();
                program = program.toLowerCase();
                if (roll.includes(inp) || name.includes(inp) || program.includes(inp)) {
                    cassiopeiaClone.push(obj);
                }
            })
            dracoClone = [];
            draco.forEach((obj) => {
                var {
                    roll,
                    name,
                    program
                } = obj;
                roll = roll.toLowerCase();
                name = name.toLowerCase();
                program = program.toLowerCase();
                if (roll.includes(inp) || name.includes(inp) || program.includes(inp)) {
                    dracoClone.push(obj);
                }
            })

            renderTableToDom(aurigaClone, pegasusClone, cassiopeiaClone, dracoClone);
        }

        function renderHouseChange(e) {
            var inp = searchbox.value;
            var option = document.getElementById("houseOptions");
            var optionValue = option.value;
            if (!inp.trim()) {
                aurigaClone = auriga;
                pegasusClone = pegasus;
                cassiopeiaClone = cassiopeia;
                dracoClone = draco;
                // renderTableToDom(auriga, pegasus, cassiopeia, draco);
                if (optionValue == 'all') {
                    renderTableToDom(auriga, pegasus, cassiopeia, draco);
                }
                else if (optionValue == 'auriga') {
                    renderTableToDom(auriga, [], [], []);
                }
                else if (optionValue == 'pegasus') {
                    renderTableToDom([], pegasus, [], []);
                }
                else if (optionValue == 'cassiopeia') {
                    renderTableToDom([], [], cassiopeia, []);
                }
                else if (optionValue == 'draco') {
                    renderTableToDom([], [], [], draco);
                }
                return 0;
            }
            aurigaClone = [];
            pegasusClone = [];
            cassiopeiaClone = [];
            dracoClone = [];
            inp = inp.toLowerCase();
            // console.log(optionValue);
            if (optionValue == 'all') {
                auriga.forEach((obj) => {
                    var {
                        roll,
                        name
                    } = obj;
                    roll = roll.toLowerCase();
                    name = name.toLowerCase();
                    if (roll.includes(inp) || name.includes(inp)) {
                        aurigaClone.push(obj);
                    }
                })
                pegasus.forEach((obj) => {
                    var {
                        roll,
                        name
                    } = obj;
                    roll = roll.toLowerCase();
                    name = name.toLowerCase();
                    if (roll.includes(inp) || name.includes(inp)) {
                        pegasusClone.push(obj);
                    }
                })
                cassiopeia.forEach((obj) => {
                    var {
                        roll,
                        name
                    } = obj;
                    roll = roll.toLowerCase();
                    name = name.toLowerCase();
                    if (roll.includes(inp) || name.includes(inp)) {
                        cassiopeiaClone.push(obj);
                    }
                })
                draco.forEach((obj) => {
                    var {
                        roll,
                        name
                    } = obj;
                    roll = roll.toLowerCase();
                    name = name.toLowerCase();
                    if (roll.includes(inp) || name.includes(inp)) {
                        dracoClone.push(obj);
                    }
                })

                renderTableToDom(aurigaClone, pegasusClone, cassiopeiaClone, dracoClone);
                document.getElementById('all').selected = true;
            } else if (optionValue == 'auriga' && inp != '') {

                auriga.forEach((obj) => {
                    var {
                        roll,
                        name
                    } = obj;
                    roll = roll.toLowerCase();
                    name = name.toLowerCase();
                    // console.log(roll);
                    if (roll.includes(inp) || name.includes(inp)) {
                        aurigaClone.push(obj);
                    }
                })
                renderTableToDom(aurigaClone, pegasusClone, cassiopeiaClone, dracoClone);
                document.getElementById('auriga').selected = true;
            }
            else if (optionValue == 'pegasus') {
                pegasus.forEach((obj) => {
                    var {
                        roll,
                        name
                    } = obj;
                    roll = roll.toLowerCase();
                    name = name.toLowerCase();
                    // console.log(roll);
                    if (roll.includes(inp) || name.includes(inp)) {
                        pegasusClone.push(obj);
                    }
                })
                renderTableToDom(aurigaClone, pegasusClone, cassiopeiaClone, dracoClone);
                document.getElementById('pegasus').selected = true;
            }

            else if (optionValue == 'cassiopeia') {
                cassiopeia.forEach((obj) => {
                    var {
                        roll,
                        name
                    } = obj;
                    roll = roll.toLowerCase();
                    name = name.toLowerCase();
                    // console.log(roll);
                    if (roll.includes(inp) || name.includes(inp)) {
                        cassiopeiaClone.push(obj);
                    }
                })
                renderTableToDom(aurigaClone, pegasusClone, cassiopeiaClone, dracoClone);
                document.getElementById('cassiopeia').selected = true;
            }

            else if (optionValue == 'draco') {
                draco.forEach((obj) => {
                    var {
                        roll,
                        name
                    } = obj;
                    roll = roll.toLowerCase();
                    name = name.toLowerCase();
                    // console.log(roll);
                    if (roll.includes(inp) || name.includes(inp)) {
                        dracoClone.push(obj);
                    }
                })
                renderTableToDom(aurigaClone, pegasusClone, cassiopeiaClone, dracoClone);
                document.getElementById('draco').selected = true;
            }
            // renderTableToDom(aurigaClone, pegasusClone, cassiopeiaClone, dracoClone);
        }
    </script>

</body>

</html>